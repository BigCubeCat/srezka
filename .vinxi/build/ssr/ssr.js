import{ssr as m,ssrHydrationKey as y,escape as c,ssrAttribute as w,createComponent as p,isServer as U,getRequestEvent as N,ssrElement as S,mergeProps as K,useAssets as Q,NoHydration as j,Hydration as V,HydrationScript as Z,renderToString as ee,renderToStream as te}from"solid-js/web";import{createSignal as C,onCleanup as ne,catchError as re,ErrorBoundary as se,lazy as oe,createComponent as ae,sharedConfig as T}from"solid-js";import"jspdf";import{provideRequestEvent as ie}from"solid-js/web/storage";import{H3Event as x,setResponseStatus as le,setHeader as ce,getRequestIP as ue,getResponseStatus as de,getResponseStatusText as pe,getResponseHeader as he,setResponseHeader as fe,removeResponseHeader as me,appendResponseHeader as ge,getResponseHeaders as ve,getRequestURL as ye,getRequestWebStream as $e,sendRedirect as be,getCookie as Re,setCookie as we,eventHandler as Ce}from"h3";import{getContext as Se}from"unctx";import{AsyncLocalStorage as Ee}from"node:async_hooks";import{createRouter as Te}from"radix3";var Ae=["<div",' class="Row"><div class="Label">','</div><input class="ColorPicker" type="color"',"></div>"];const xe=e=>m(Ae,y(),c(e.label),w("value",c(e.value,!0),!1));var He=["<div",' class="Column"><div class="Label">','</div><input class="SpinBox" type="number" min="1"',"></div>"];const q=e=>m(He,y(),c(e.label),w("value",c(e.value,!0),!1));var ke=["<div",' class="Config"><div class="Geometry"><!--$-->',"<!--/--><!--$-->","<!--/--></div><!--$-->","<!--/--></div>"];const Ie=e=>m(ke,y(),c(p(q,{label:"Строк",get value(){return e.rows},get callback(){return e.setRows}})),c(p(q,{label:"Столбцов",get value(){return e.cols},get callback(){return e.setCols}})),c(p(xe,{label:"Цвет",get onChange(){return e.setColor},get value(){return e.color}})));var qe=["<div",' class="file-input-container"><input type="file" accept="image/png, image/jpeg" style="','"><button type="button" class="file-input-button">',"</button></div>"];const Pe=e=>m(qe,y(),"display:none",c(e.label)||"Выберите файл"),_e=e=>p(Pe,{label:"Файл с картой",handleFileChange:t=>{const r=t.target;if(r.files&&r.files[0]){const o=r.files[0],l=new FileReader;l.onload=s=>{e.imageCallback(s.target?.result)},l.readAsDataURL(o)}}}),Fe=(e,n,t,r,o)=>{const l=[];for(let s=0;s<e;s++)for(let i=0;i<n;i++){const u=document.createElement("canvas");u.width=t,u.height=r;const h=u.getContext("2d");h&&(h.drawImage(o,i*t,s*r,t,r,0,0,t,r),l.push(u.toDataURL("image/png")))}return l},Le=15,Me=12,De=()=>{const[e,n]=C(null),[t,r]=C(null),[o,l]=C([]);return{imageSrc:e,setImageSrc:n,fullImageDataUrl:t,cellDataUrls:o,generateGrid:(i,u,h)=>{if(!e())return;const d=new Image;d.onload=()=>{const f=document.createElement("canvas"),a=f.getContext("2d");if(!a)return;d.width>d.height?(f.width=d.height,f.height=d.width,a.save(),a.translate(f.width,0),a.rotate(Math.PI/2),a.drawImage(d,0,0),a.restore()):(f.width=d.width,f.height=d.height,a.drawImage(d,0,0));const v=f.width/u,R=f.height/i;l(Fe(i,u,v,R,f)),a.strokeStyle=h,a.lineWidth=2;for(let $=0;$<=u;$++){const b=$*v;a.beginPath(),a.moveTo(b,0),a.lineTo(b,f.height),a.stroke()}for(let $=0;$<=i;$++){const b=$*R;a.beginPath(),a.moveTo(0,b),a.lineTo(f.width,b),a.stroke()}a.font="20px Arial",a.fillStyle=h,a.textAlign="center",a.textBaseline="middle";for(let $=0;$<i;$++)for(let b=0;b<u;b++){const J=`${String.fromCharCode(65+$)}${b+1}`,Y=b*v+Le,X=$*R+Me;a.fillText(J,Y,X)}r(f.toDataURL("image/png"))},d.src=e()}}},Ue=(e=3,n=3)=>{const[t,r]=C(e),[o,l]=C(n),[s,i]=C("#000000");return{rows:t,setRows:r,cols:o,setCols:l,color:s,setColor:i}};var Ne=["<div",' class="MainComponent"><!--$-->',"<!--/--><!--$-->",'<!--/--><button type="button" class="download-button">Скачать</button></div>'];const je=()=>{const{rows:e,cols:n,color:t,setRows:r,setCols:o,setColor:l}=Ue(),{setImageSrc:s,generateGrid:i,fullImageDataUrl:u}=De(),h=a=>{s(a),i(e(),n(),t())},d=a=>v=>{a(v),i(e(),n(),t())},f=a=>{l(a),i(e(),n(),t())};return m(Ne,y(),c(p(Ie,{get rows(){return e()},get cols(){return n()},get color(){return t()},get setRows(){return d(r)},get setCols(){return d(o)},setColor:f})),c(p(_e,{imageCallback:h,get dataUrl(){return u()||""}})))};var Oe=["<div",' class="app">',"</div>"];const Ge=()=>m(Oe,y(),c(p(je,{}))),O=U?e=>{const n=N();return n.response.status=e.code,n.response.statusText=e.text,ne(()=>!n.nativeEvent.handled&&!n.complete&&(n.response.status=200)),null}:e=>null;var We=["<span",' style="font-size:1.5em;text-align:center;position:fixed;left:0px;bottom:55%;width:100%;">',"</span>"],Be=["<span",' style="font-size:1.5em;text-align:center;position:fixed;left:0px;bottom:55%;width:100%;">500 | Internal Server Error</span>'];const ze=e=>{const n=U?"500 | Internal Server Error":"Error | Uncaught Client Exception";return p(se,{fallback:t=>(console.error(t),[m(We,y(),c(n)),p(O,{code:500})]),get children(){return e.children}})},Je=e=>{let n=!1;const t=re(()=>e.children,r=>{console.error(r),n=!!r});return n?[m(Be,y()),p(O,{code:500})]:t};var Ye=" ";const Xe={style:e=>S("style",e.attrs,()=>c(e.children),!0),link:e=>S("link",e.attrs,void 0,!0),script:e=>e.attrs.src?S("script",K(()=>e.attrs,{get id(){return e.key}}),()=>m(Ye),!0):null,noscript:e=>S("noscript",e.attrs,()=>c(e.children),!0)};function H(e,n){let{tag:t,attrs:{key:r,...o}={key:void 0},children:l}=e;return Xe[t]({attrs:{...o,nonce:n},key:r,children:l})}var P=["<script",">","<\/script>"],Ke=["<script",' type="module"'," async","><\/script>"],Qe=["<script",' type="module" async',"><\/script>"];const Ve=m("<!DOCTYPE html>");function G(e,n,t=[]){for(let r=0;r<n.length;r++){const o=n[r];if(o.path!==e[0].path)continue;let l=[...t,o];if(o.children){const s=e.slice(1);if(s.length===0||(l=G(s,o.children,l),!l))continue}return l}}function Ze(e){const n=N(),t=n.nonce;let r=[];return Promise.resolve().then(async()=>{let o=[];if(n.router&&n.router.matches){const l=[...n.router.matches];for(;l.length&&(!l[0].info||!l[0].info.filesystem);)l.shift();const s=l.length&&G(l,n.routes);if(s){const i=globalThis.MANIFEST.client.inputs;for(let u=0;u<s.length;u++){const h=s[u],d=i[h.$component.src];o.push(d.assets())}}}r=await Promise.all(o).then(l=>[...new Map(l.flat().map(s=>[s.attrs.key,s])).values()].filter(s=>s.attrs.rel==="modulepreload"&&!n.assets.find(i=>i.attrs.key===s.attrs.key)))}),Q(()=>r.length?r.map(o=>H(o)):void 0),p(j,{get children(){return[Ve,p(Je,{get children(){return p(e.document,{get assets(){return[p(Z,{}),n.assets.map(o=>H(o,t))]},get scripts(){return t?[m(P,y()+w("nonce",c(t,!0),!1),`window.manifest = ${JSON.stringify(n.manifest)}`),m(Ke,y(),w("nonce",c(t,!0),!1),w("src",c(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]:[m(P,y(),`window.manifest = ${JSON.stringify(n.manifest)}`),m(Qe,y(),w("src",c(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]},get children(){return p(V,{get children(){return p(ze,{get children(){return p(Ge,{})}})}})}})}})]}})}function et(e){let n;const t=B(e),r={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...r,body:e.node.req.body}):new Request(t,{...r,get body(){return n||(n=dt(e),n)}})}function tt(e){return e.web??={request:et(e),url:B(e)},e.web.request}function nt(){return mt()}const W=Symbol("$HTTPEvent");function rt(e){return typeof e=="object"&&(e instanceof x||e?.[W]instanceof x||e?.__is_event__===!0)}function g(e){return function(...n){let t=n[0];if(rt(t))n[0]=t instanceof x||t.__is_event__?t:t[W];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(t=nt(),!t)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");n.unshift(t)}return e(...n)}}const B=g(ye),st=g(ue),k=g(le),_=g(de),ot=g(pe),E=g(ve),F=g(he),at=g(fe),it=g(ge),L=g(be),lt=g(Re),ct=g(we),ut=g(ce),dt=g($e),pt=g(me),ht=g(tt);function ft(){return Se("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:Ee})}function mt(){return ft().use().event}const z=[],gt=vt(z.filter(e=>e.page));function vt(e){function n(t,r,o,l){const s=Object.values(t).find(i=>o.startsWith(i.id+"/"));return s?(n(s.children||(s.children=[]),r,o.slice(s.id.length)),t):(t.push({...r,id:o,path:o.replace(/\/\([^)/]+\)/g,"").replace(/\([^)/]+\)/g,"")}),t)}return e.sort((t,r)=>t.path.length-r.path.length).reduce((t,r)=>n(t,r,r.path,r.path),[])}function yt(e,n){const t=bt.lookup(e);if(t&&t.route){const r=n==="HEAD"?t.route.$HEAD||t.route.$GET:t.route[`$${n}`];return r===void 0?void 0:{handler:r,params:t.params}}}function $t(e){return e.$HEAD||e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}const bt=Te({routes:z.reduce((e,n)=>{if(!$t(n))return e;let t=n.path.replace(/\/\([^)/]+\)/g,"").replace(/\([^)/]+\)/g,"").replace(/\*([^/]*)/g,(r,o)=>`**:${o}`).split("/").map(r=>r.startsWith(":")||r.startsWith("*")?r:encodeURIComponent(r)).join("/");if(/:[^/]*\?/g.test(t))throw new Error(`Optional parameters are not supported in API routes: ${t}`);if(e[t])throw new Error(`Duplicate API routes for "${t}" found at "${e[t].route.path}" and "${n.path}"`);return e[t]={route:n},e},{})}),A="solidFetchEvent";function Rt(e){return{request:ht(e),response:St(e),clientAddress:st(e),locals:{},nativeEvent:e}}function wt(e){if(!e.context[A]){const n=Rt(e);e.context[A]=n}return e.context[A]}class Ct{event;constructor(n){this.event=n}get(n){const t=F(this.event,n);return Array.isArray(t)?t.join(", "):t||null}has(n){return this.get(n)!==void 0}set(n,t){return at(this.event,n,t)}delete(n){return pt(this.event,n)}append(n,t){it(this.event,n,t)}getSetCookie(){const n=F(this.event,"Set-Cookie");return Array.isArray(n)?n:[n]}forEach(n){return Object.entries(E(this.event)).forEach(([t,r])=>n(Array.isArray(r)?r.join(", "):r,t,this))}entries(){return Object.entries(E(this.event)).map(([n,t])=>[n,Array.isArray(t)?t.join(", "):t])[Symbol.iterator]()}keys(){return Object.keys(E(this.event))[Symbol.iterator]()}values(){return Object.values(E(this.event)).map(n=>Array.isArray(n)?n.join(", "):n)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function St(e){return{get status(){return _(e)},set status(n){k(e,n)},get statusText(){return ot(e)},set statusText(n){k(e,_(e),n)},headers:new Ct(e)}}function Et(e){e.forEach(n=>{if(!n.attrs.href)return;let t=document.head.querySelector(`link[href="${n.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",n.attrs.href),document.head.appendChild(t))})}function Tt(e,n,t,r="default"){return oe(async()=>{{const l=(await e.import())[r],i=(await n.inputs?.[e.src].assets()).filter(h=>h.tag==="style"||h.attrs.rel==="stylesheet");return typeof window<"u"&&Et(i),{default:h=>[...i.map(d=>H(d)),ae(l,h)]}}})}function At(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,info:{...t.$$route?t.$$route.require().route.info:{},filesystem:!0},component:t.$component&&Tt(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return gt.map(e)}function xt(e){const n=lt(e.nativeEvent,"flash");if(n)try{let t=JSON.parse(n);if(!t||!t.result)return;const r=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])],o=t.error?new Error(t.result):t.result;return{input:r,url:t.url,pending:!1,result:t.thrown?void 0:o,error:t.thrown?o:void 0}}catch(t){console.error(t)}finally{ct(e.nativeEvent,"flash","",{maxAge:0})}}async function Ht(e){const n=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await n.json(),assets:[...await n.inputs[n.handler].assets()],router:{submission:xt(e)},routes:At(),complete:!1,$islands:new Set})}const kt=new Set([301,302,303,307,308]);function I(e){return e.status&&kt.has(e.status)?e.status:302}function It(e,n,t={}){return Ce({handler:r=>{const o=wt(r);return ie(o,async()=>{const l=yt(new URL(o.request.url).pathname,o.request.method);if(l){const a=await l.handler.import(),v=o.request.method==="HEAD"?a.HEAD||a.GET:a[o.request.method];o.params=l.params||{},T.context={event:o};const R=await v(o);if(R!==void 0)return R;if(o.request.method!=="GET")throw new Error(`API handler for ${o.request.method} "${o.request.url}" did not return a response.`)}const s=await n(o),i=typeof t=="function"?await t(s):{...t},u=i.mode||"stream";if(i.nonce&&(s.nonce=i.nonce),u==="sync"){const a=ee(()=>(T.context.event=s,e(s)),i);if(s.complete=!0,s.response&&s.response.headers.get("Location")){const v=I(s.response);return L(r,s.response.headers.get("Location"),v)}return a}if(i.onCompleteAll){const a=i.onCompleteAll;i.onCompleteAll=v=>{D(s)(v),a(v)}}else i.onCompleteAll=D(s);if(i.onCompleteShell){const a=i.onCompleteShell;i.onCompleteShell=v=>{M(s,r)(),a(v)}}else i.onCompleteShell=M(s,r);const h=te(()=>(T.context.event=s,e(s)),i);if(s.response&&s.response.headers.get("Location")){const a=I(s.response);return L(r,s.response.headers.get("Location"),a)}if(u==="async")return h;const{writable:d,readable:f}=new TransformStream;return h.pipeTo(d),f})}})}function M(e,n){return()=>{if(e.response&&e.response.headers.get("Location")){const t=I(e.response);k(n,t),ut(n,"Location",e.response.headers.get("Location"))}}}function D(e){return({write:n})=>{e.complete=!0;const t=e.response&&e.response.headers.get("Location");t&&n(`<script>window.location="${t}"<\/script>`)}}function qt(e,n){return It(e,Ht,n)}var Pt=['<head><title>Srezka</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],_t=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const Gt=qt(()=>p(Ze,{document:({assets:e,children:n,scripts:t})=>m(_t,y(),p(j,{get children(){return m(Pt,c(e))}}),c(n),c(t))}));export{Gt as default};
